<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job-Seeker Dashboard | Verify</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { primary: "#F50302", secondary: "#1F2937" },
            borderRadius: {
              none: "0px",
              sm: "4px",
              DEFAULT: "8px",
              md: "12px",
              lg: "16px",
              xl: "20px",
              "2xl": "24px",
              "3xl": "32px",
              full: "9999px",
              button: "8px",
            },
            fontFamily: { futura: ["Futura", "sans-serif"] },
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css"
    />
    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
      :root {
      --primary-red: #F50302;
      --primary-red-hover: #D40201;
      --text-gray: #1F2937;
      --gap-lg: 2rem;
      --gap-xl: 3rem;
      }
      #notificationToast {
      opacity: 1;
      transition: opacity 0.3s ease-in-out;
      }
      .switch input:checked + .slider {
      transition: background-color 0.3s ease;
      }
      .slider:before {
      transition: transform 0.3s ease, background-color 0.3s ease;
      }
      h2 {
      font-size: clamp(1.5rem, 4vw, 2rem);
      }
      p {
      font-size: clamp(1rem, 2vw, 1.125rem);
      }
      @media (max-width: 600px) {
      .flex {
      flex-direction: column;
      gap: var(--gap-lg);
      }
      }
      :where([class^="ri-"])::before { content: "\f3c2"; }
      body {
      font-family: 'Futura', sans-serif;
      background-color: #f9fafb;
      }
      .progress-ring {
      position: relative;
      width: 120px;
      height: 120px;
      }
      .progress-ring-circle {
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
      stroke-dasharray: 283;
      transition: stroke-dashoffset 0.5s;
      }
      .progress-ring-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      }
      input[type="checkbox"] {
      appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid #e5e7eb;
      border-radius: 4px;
      position: relative;
      cursor: pointer;
      }
      input[type="checkbox"]:checked {
      background-color: #F50302;
      border-color: #F50302;
      }
      input[type="checkbox"]:checked::after {
      content: "";
      position: absolute;
      top: 3px;
      left: 6px;
      width: 6px;
      height: 10px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
      }
      .tier-card {
      transition: transform 0.2s, box-shadow 0.2s;
      }
      .tier-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      .step-connector {
      height: 2px;
      background-color: #e5e7eb;
      flex-grow: 1;
      margin: 0 4px;
      }
      .step-connector.completed {
      background-color: #9CA3AF;
      }
      .step-connector.active {
      background-color: #F50302;
      }
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
      }
      .switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
      }
      .switch input {
      opacity: 0;
      width: 0;
      height: 0;
      }
      .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #e5e7eb;
      transition: .4s;
      border-radius: 24px;
      }
      .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
      }
      input:checked + .slider {
      background-color: #F50302;
      }
      input:checked + .slider:before {
      transform: translateX(20px);
      }
      .tab-indicator {
      transition: transform 0.3s ease;
      }
    </style>
  </head>
  <body class="min-h-screen font-futura">
    <!-- Top Navigation -->
    <header class="bg-white shadow-sm fixed top-0 left-0 right-0 z-50">
      <div
        class="container mx-auto px-4 h-16 flex items-center justify-between"
      >
        <div class="flex items-center">
          <a href="#" class="flex items-center">
            <img
              src="https://static.readdy.ai/image/783dd8c3d2d1f38f9648f46144ac17f1/df31ee2d29793c036f4e935aa3f06ca0.jpeg"
              alt="Verify logo"
              class="h-12"
            />
          </a>
        </div>
        <nav class="hidden md:flex space-x-8">
          <a
            href="#"
            class="text-primary font-medium border-b-2 border-primary pb-1"
            >Dashboard</a
          >
          <a
            href="https://readdy.ai/home/c14c6ca2-d668-408a-94aa-6976679ad86b/52758506-6d22-4046-b708-48ee0287008c"
            data-readdy="true"
            class="text-gray-600 hover:text-gray-900 font-medium"
            >Messages</a
          >
          <a href="#" class="text-gray-600 hover:text-gray-900 font-medium"
            >Profile</a
          >
        </nav>
        <div class="flex items-center">
          <div class="relative">
            <button
              id="userMenuButton"
              class="flex items-center space-x-2 focus:outline-none"
            >
              <div class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden">
                <img
                  src="https://readdy.ai/api/search-image?query=professional%20portrait%20of%20a%20South%20African%20man%20in%20his%2030s%2C%20warm%20smile%2C%20casual%20attire%2C%20neutral%20background%2C%20high%20quality%2C%20realistic&width=200&height=200&seq=avatar1&orientation=squarish"
                  alt="User avatar"
                  class="w-full h-full object-cover"
                />
              </div>
              <div class="hidden md:block text-left">
                <p class="text-sm font-medium text-gray-900" id="userName"></p>
                <p class="text-xs text-gray-500" id="userRole"></p>
              </div>
              <div
                class="w-5 h-5 flex items-center justify-center text-gray-400"
              >
                <i class="ri-arrow-down-s-line"></i>
              </div>
            </button>
            <div
              id="userMenu"
              class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 hidden"
            >
              <a
                href="#"
                id="logoutLink"
                class="flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50"
              >
                <i class="ri-logout-box-r-line mr-2"></i>
                <span>Logout</span>
              </a>
              <div
                id="logoutDialog"
                class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
              >
                <div class="bg-white rounded-lg p-6 max-w-sm w-full mx-4">
                  <h3 class="text-lg font-medium text-gray-900 mb-4">
                    Are you sure you want to log out?
                  </h3>
                  <div class="flex justify-end space-x-3">
                    <button
                      id="cancelLogout"
                      class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-button hover:bg-gray-200"
                    >
                      Cancel
                    </button>
                    <a
                      href="https://readdy.ai/home/c14c6ca2-d668-408a-94aa-6976679ad86b/0c4af476-1405-4543-b628-417302d1465c"
                      data-readdy="true"
                    >
                      <button
                        id="confirmLogout"
                        class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-button hover:bg-[var(--primary-red-hover)]"
                      >
                        Logout
                      </button>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <!-- Main Content -->
    <main class="container mx-auto px-4 pt-24 pb-24">
      <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-900">
          Welcome back, <span id="welcomeName"></span>
        </h1>
        <p class="text-gray-600">Let's continue your job search journey</p>
      </div>
      <!-- Verification Progress Section -->
      <div class="bg-white rounded p-6 shadow-sm mb-6">
        <div class="flex flex-col md:flex-row items-center">
          <div class="flex-shrink-0 mb-4 md:mb-0 md:mr-8">
            <div class="progress-ring">
              <img
                src="https://static.readdy.ai/image/783dd8c3d2d1f38f9648f46144ac17f1/825f3689b7ec20483d16e334aa588aec.png"
                alt="Progress ring"
                class="w-[120px] h-[120px]"
              />
              <div class="progress-ring-text">
                <span
                  class="block text-3xl font-bold text-gray-900"
                  id="progressPercentage"
                  >0%</span
                >
                <span class="text-sm text-gray-500">Complete</span>
              </div>
            </div>
          </div>
          <div class="flex-grow">
            <div class="flex flex-col gap-3 mb-4">
              <div class="flex items-center justify-between">
                <h2 class="text-xl font-semibold text-gray-900">
                  Complete Your Verification
                </h2>
                <div
                  class="flex items-center bg-[#CD7F32]/10 px-3 py-1 rounded-full"
                >
                  <i class="ri-medal-line text-[#CD7F32] mr-1"></i>
                  <span class="text-sm font-medium text-[#CD7F32]"
                    >Bronze Level</span
                  >
                </div>
              </div>
              <div class="flex items-center gap-2 text-sm text-gray-600">
                <span>Current Level:</span>
                <div class="flex items-center">
                  <i class="ri-medal-line text-[#CD7F32] mr-1"></i>
                  <span class="font-medium text-[#CD7F32]">Bronze</span>
                </div>
                <span class="mx-2">•</span>
                <span></span>
              </div>
            </div>
            <p class="text-gray-600 mb-4">
              Complete verification steps to unlock more job opportunities and
              higher trust levels
            </p>
            <div class="flex items-center">
              <button
                class="ml-3 flex items-center text-gray-600 hover:text-gray-900 btn"
                aria-label="Listen to instructions"
              >
                <div
                  class="w-8 h-8 flex items-center justify-center bg-gray-100 rounded-full"
                >
                  <i class="ri-volume-up-line"></i>
                </div>
                <span class="ml-2 text-sm">Listen</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Tier Selection -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <!-- Bronze Tier -->
        <div
          class="bg-white rounded-lg p-8 shadow-sm hover:shadow-lg transition-shadow"
        >
          <div
            class="w-16 h-16 bg-[#CD7F32] rounded-full flex items-center justify-center mx-auto mb-6"
          >
            <img
              src="https://static.readdy.ai/image/783dd8c3d2d1f38f9648f46144ac17f1/f59aea6d0cce8b1a2b73d843bbd4d485.png"
              alt="Bronze tier"
              class="w-8 h-8"
            />
          </div>
          <h3 class="text-xl font-semibold text-center mb-2">Bronze</h3>
          <p class="text-sm text-gray-600 text-center mb-6">
            Basic Verification
          </p>
          <p class="text-sm text-gray-500 text-center mb-8">
            Contact us for pricing
          </p>
          <ul class="space-y-4 mb-8 text-left">
            <li class="flex items-center">
              <i class="ri-check-line text-primary mr-2"></i>
              <span>CV Verification</span>
            </li>
            <li class="flex items-center text-gray-400">
              <i class="ri-close-line mr-2"></i>
              <span>Police Clearance</span>
            </li>
            <li class="flex items-center text-gray-400">
              <i class="ri-close-line mr-2"></i>
              <span>Polygraph Test</span>
            </li>
          </ul>
          <button
            class="w-full bg-primary text-white py-2 rounded-button font-medium hover:bg-[var(--primary-red-hover)] transition-colors"
          >
            Select Bronze
          </button>
        </div>
        <!-- Silver Tier -->
        <div
          class="bg-white rounded-lg p-8 shadow-sm hover:shadow-lg transition-shadow relative"
        >
          <div
            class="w-16 h-16 bg-[#C0C0C0] rounded-full flex items-center justify-center mx-auto mb-6"
          >
            <img
              src="https://static.readdy.ai/image/783dd8c3d2d1f38f9648f46144ac17f1/f59aea6d0cce8b1a2b73d843bbd4d485.png"
              alt="Silver tier"
              class="w-8 h-8"
            />
          </div>
          <h3 class="text-xl font-semibold text-center mb-2">Silver</h3>
          <p class="text-sm text-gray-600 text-center mb-6">
            Enhanced Verification
          </p>
          <p class="text-sm text-gray-500 text-center mb-8">
            Contact us for pricing
          </p>
          <ul class="space-y-4 mb-8 text-left">
            <li class="flex items-center">
              <i class="ri-check-line text-primary mr-2"></i>
              <span>CV Verification</span>
            </li>
            <li class="flex items-center">
              <i class="ri-check-line text-primary mr-2"></i>
              <span>Police Clearance</span>
            </li>
            <li class="flex items-center text-gray-400">
              <i class="ri-close-line mr-2"></i>
              <span>Polygraph Test</span>
            </li>
          </ul>
          <button
            id="upgradeSilverBtn"
            class="w-full bg-primary text-white py-2 rounded-button font-medium hover:bg-[var(--primary-red-hover)] transition-colors"
          >
            Upgrade to Silver
          </button>
          <div
            id="upgradeDialog"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
          >
            <div class="bg-white rounded-lg p-6 max-w-lg w-full mx-4">
              <div class="flex justify-between items-start mb-4">
                <h3 class="text-xl font-semibold text-gray-900">
                  Upgrade to Silver Tier
                </h3>
                <button
                  id="closeUpgradeDialog"
                  class="text-gray-400 hover:text-gray-500"
                >
                  <i class="ri-close-line text-xl"></i>
                </button>
              </div>
              <script>
                document.addEventListener("DOMContentLoaded", function () {
                  const upgradeSilverBtn = document.getElementById("upgradeSilverBtn");
                  const upgradeDialog = document.getElementById("upgradeDialog");
                  const closeUpgradeDialog = document.getElementById("closeUpgradeDialog");
                  const cancelUpgrade = document.getElementById("cancelUpgrade");
                  const confirmUpgrade = document.getElementById("confirmUpgrade");
                  const policeClearanceSection = document.getElementById(
                    "policeClearanceSection",
                  );
                  function showUpgradeDialog() {
                    upgradeDialog.classList.remove("hidden");
                    document.body.style.overflow = "hidden";
                  }
                  function hideUpgradeDialog() {
                    upgradeDialog.classList.add("hidden");
                    document.body.style.overflow = "";
                  }
                  async function handleUpgrade() {
                    try {
                      // Simulate API call
                      await new Promise((resolve) => setTimeout(resolve, 1000));
                      // Update user tier
                      sessionStorage.setItem("userTier", "Silver");
                      // Show police clearance section
                      if (policeClearanceSection) {
                        policeClearanceSection.classList.remove("hidden");
                      }
                      // Show success toast
                      const toast = document.createElement("div");
                      toast.id = "notificationToast";
                      toast.className =
                        "fixed top-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-opacity duration-300";
                      toast.textContent = "Successfully upgraded to Silver tier!";
                      document.body.appendChild(toast);
                      setTimeout(() => {
                        toast.style.opacity = "0";
                        setTimeout(() => toast.remove(), 300);
                      }, 3000);
                      // Hide dialog
                      hideUpgradeDialog();
                      // Dispatch event for tier change
                      window.dispatchEvent(new Event("userTierChanged"));
                    } catch (error) {
                      console.error("Upgrade failed:", error);
                      const toast = document.createElement("div");
                      toast.id = "notificationToast";
                      toast.className =
                        "fixed top-20 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50";
                      toast.textContent = "Failed to upgrade. Please try again.";
                      document.body.appendChild(toast);
                      setTimeout(() => toast.remove(), 3000);
                    }
                  }
                  upgradeSilverBtn.addEventListener("click", showUpgradeDialog);
                  closeUpgradeDialog.addEventListener("click", hideUpgradeDialog);
                  cancelUpgrade.addEventListener("click", hideUpgradeDialog);
                  confirmUpgrade.addEventListener("click", handleUpgrade);
                  document.addEventListener("keydown", function (e) {
                    if (e.key === "Escape" && !upgradeDialog.classList.contains("hidden")) {
                      hideUpgradeDialog();
                    }
                  });
                  upgradeDialog.addEventListener("click", function (e) {
                    if (e.target === upgradeDialog) {
                      hideUpgradeDialog();
                    }
                  });
                });
              </script>
              <div class="space-y-4 mb-6">
                <p class="text-gray-600">
                  Enhance your verification status and improve your job
                  prospects with our Silver tier benefits:
                </p>
                <ul class="space-y-3">
                  <li class="flex items-center text-gray-700">
                    <i class="ri-check-line text-primary mr-2"></i>
                    <span>Professional CV Verification</span>
                  </li>
                  <li class="flex items-center text-gray-700">
                    <i class="ri-check-line text-primary mr-2"></i>
                    <span>Comprehensive Police Clearance Check</span>
                  </li>
                  <li class="flex items-center text-gray-700">
                    <i class="ri-check-line text-primary mr-2"></i>
                    <span>Enhanced Profile Visibility</span>
                  </li>
                  <li class="flex items-center text-gray-700">
                    <i class="ri-check-line text-primary mr-2"></i>
                    <span>Faster Application Processing</span>
                  </li>
                  <li class="flex items-center text-gray-700">
                    <i class="ri-check-line text-primary mr-2"></i>
                    <span>Direct Employer Communication</span>
                  </li>
                </ul>
                <div class="bg-gray-50 p-4 rounded-lg mt-4">
                  <div class="flex justify-between items-center mb-2">
                    <span class="font-medium text-gray-900"
                      >Silver Tier Price</span
                    >
                    <span class="text-primary font-semibold"
                      >Contact for Pricing</span
                    >
                  </div>
                  <p class="text-sm text-gray-500">
                    Billed as a one-time payment
                  </p>
                </div>
                <div class="mt-4 bg-blue-50 p-4 rounded-lg">
                  <div class="flex items-start">
                    <i
                      class="ri-information-line text-blue-500 mt-0.5 mr-2"
                    ></i>
                    <p class="text-sm text-blue-700">
                      Upgrading to Silver tier will unlock additional
                      verification options and improve your profile credibility
                      with employers.
                    </p>
                  </div>
                </div>
              </div>
              <div class="flex justify-end space-x-3">
                <button
                  id="cancelUpgrade"
                  class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-button hover:bg-gray-200"
                >
                  Cancel
                </button>
                <button
                  id="confirmUpgrade"
                  class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-button hover:bg-[var(--primary-red-hover)]"
                >
                  Confirm Upgrade
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- Gold Tier -->
        <div
          class="bg-white rounded-lg p-8 shadow-sm hover:shadow-lg transition-shadow relative"
        >
          <div
            class="w-16 h-16 bg-[#FFD700] rounded-full flex items-center justify-center mx-auto mb-6"
          >
            <img
              src="https://static.readdy.ai/image/783dd8c3d2d1f38f9648f46144ac17f1/f59aea6d0cce8b1a2b73d843bbd4d485.png"
              alt="Gold tier"
              class="w-8 h-8"
            />
          </div>
          <h3 class="text-xl font-semibold text-center mb-2">Gold</h3>
          <p class="text-sm text-gray-600 text-center mb-6">
            Premium Verification
          </p>
          <p class="text-sm text-gray-500 text-center mb-8">
            Contact us for pricing
          </p>
          <ul class="space-y-4 mb-8 text-left">
            <li class="flex items-center">
              <i class="ri-check-line text-primary mr-2"></i>
              <span>CV Verification</span>
            </li>
            <li class="flex items-center">
              <i class="ri-check-line text-primary mr-2"></i>
              <span>Police Clearance</span>
            </li>
            <li class="flex items-center">
              <i class="ri-check-line text-primary mr-2"></i>
              <span>Polygraph Test</span>
            </li>
          </ul>
          <button
            id="upgradeSilverBtn"
            class="w-full bg-primary text-white py-2 rounded-button font-medium hover:bg-[var(--primary-red-hover)] transition-colors"
          >
            Upgrade to Silver
          </button>
          <div
            id="upgradeDialog"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50"
          >
            <div class="bg-white rounded-lg p-6 max-w-lg w-full mx-4">
              <div class="flex justify-between items-start mb-4">
                <h3 class="text-xl font-semibold text-gray-900">
                  Upgrade to Silver Tier
                </h3>
                <button
                  id="closeUpgradeDialog"
                  class="text-gray-400 hover:text-gray-500"
                >
                  <i class="ri-close-line text-xl"></i>
                </button>
              </div>
              <script>
                document.addEventListener("DOMContentLoaded", function () {
                  const upgradeSilverBtn = document.getElementById("upgradeSilverBtn");
                  const upgradeDialog = document.getElementById("upgradeDialog");
                  const closeUpgradeDialog = document.getElementById("closeUpgradeDialog");
                  const cancelUpgrade = document.getElementById("cancelUpgrade");
                  const confirmUpgrade = document.getElementById("confirmUpgrade");
                  const policeClearanceSection = document.getElementById(
                    "policeClearanceSection",
                  );
                  function showUpgradeDialog() {
                    upgradeDialog.classList.remove("hidden");
                    document.body.style.overflow = "hidden";
                  }
                  function hideUpgradeDialog() {
                    upgradeDialog.classList.add("hidden");
                    document.body.style.overflow = "";
                  }
                  async function handleUpgrade() {
                    try {
                      // Simulate API call
                      await new Promise((resolve) => setTimeout(resolve, 1000));
                      // Update user tier
                      sessionStorage.setItem("userTier", "Silver");
                      // Show police clearance section
                      if (policeClearanceSection) {
                        policeClearanceSection.classList.remove("hidden");
                      }
                      // Show success toast
                      const toast = document.createElement("div");
                      toast.id = "notificationToast";
                      toast.className =
                        "fixed top-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-opacity duration-300";
                      toast.textContent = "Successfully upgraded to Silver tier!";
                      document.body.appendChild(toast);
                      setTimeout(() => {
                        toast.style.opacity = "0";
                        setTimeout(() => toast.remove(), 300);
                      }, 3000);
                      // Hide dialog
                      hideUpgradeDialog();
                      // Dispatch event for tier change
                      window.dispatchEvent(new Event("userTierChanged"));
                    } catch (error) {
                      console.error("Upgrade failed:", error);
                      const toast = document.createElement("div");
                      toast.id = "notificationToast";
                      toast.className =
                        "fixed top-20 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50";
                      toast.textContent = "Failed to upgrade. Please try again.";
                      document.body.appendChild(toast);
                      setTimeout(() => toast.remove(), 3000);
                    }
                  }
                  upgradeSilverBtn.addEventListener("click", showUpgradeDialog);
                  closeUpgradeDialog.addEventListener("click", hideUpgradeDialog);
                  cancelUpgrade.addEventListener("click", hideUpgradeDialog);
                  confirmUpgrade.addEventListener("click", handleUpgrade);
                  document.addEventListener("keydown", function (e) {
                    if (e.key === "Escape" && !upgradeDialog.classList.contains("hidden")) {
                      hideUpgradeDialog();
                    }
                  });
                  upgradeDialog.addEventListener("click", function (e) {
                    if (e.target === upgradeDialog) {
                      hideUpgradeDialog();
                    }
                  });
                });
              </script>
              <div class="space-y-4 mb-6">
                <p class="text-gray-600">
                  Enhance your verification status and improve your job
                  prospects with our Silver tier benefits:
                </p>
                <ul class="space-y-3">
                  <li class="flex items-center text-gray-700">
                    <i class="ri-check-line text-primary mr-2"></i>
                    <span>Professional CV Verification</span>
                  </li>
                  <li class="flex items-center text-gray-700">
                    <i class="ri-check-line text-primary mr-2"></i>
                    <span>Comprehensive Police Clearance Check</span>
                  </li>
                  <li class="flex items-center text-gray-700">
                    <i class="ri-check-line text-primary mr-2"></i>
                    <span>Enhanced Profile Visibility</span>
                  </li>
                  <li class="flex items-center text-gray-700">
                    <i class="ri-check-line text-primary mr-2"></i>
                    <span>Faster Application Processing</span>
                  </li>
                  <li class="flex items-center text-gray-700">
                    <i class="ri-check-line text-primary mr-2"></i>
                    <span>Direct Employer Communication</span>
                  </li>
                </ul>
                <div class="bg-gray-50 p-4 rounded-lg mt-4">
                  <div class="flex justify-between items-center mb-2">
                    <span class="font-medium text-gray-900"
                      >Silver Tier Price</span
                    >
                    <span class="text-primary font-semibold"
                      >Contact for Pricing</span
                    >
                  </div>
                  <p class="text-sm text-gray-500">
                    Billed as a one-time payment
                  </p>
                </div>
                <div class="mt-4 bg-blue-50 p-4 rounded-lg">
                  <div class="flex items-start">
                    <i
                      class="ri-information-line text-blue-500 mt-0.5 mr-2"
                    ></i>
                    <p class="text-sm text-blue-700">
                      Upgrading to Silver tier will unlock additional
                      verification options and improve your profile credibility
                      with employers.
                    </p>
                  </div>
                </div>
              </div>
              <div class="flex justify-end space-x-3">
                <button
                  id="cancelUpgrade"
                  class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-button hover:bg-gray-200"
                >
                  Cancel
                </button>
                <button
                  id="confirmUpgrade"
                  class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-button hover:bg-[var(--primary-red-hover)]"
                >
                  Confirm Upgrade
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Primary Cards Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <!-- New Interest Card -->
        <div class="bg-white rounded shadow-sm p-6" id="interestsCard">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h2 class="text-lg font-semibold text-gray-900">New Interest</h2>
              <p class="text-sm text-gray-500" id="totalViews">
                Total views: Loading...
              </p>
            </div>
            <div
              class="w-8 h-8 flex items-center justify-center bg-primary/10 rounded-full"
            >
              <i class="ri-eye-line text-primary"></i>
            </div>
          </div>
          <div id="interestsContent">
            <!-- Loading state -->
            <div class="text-center py-4" id="interestsLoading">
              <div
                class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto"
              ></div>
              <p class="text-sm text-gray-500 mt-2">Loading interests...</p>
            </div>
            <!-- Error state -->
            <div class="text-center py-4 hidden" id="interestsError">
              <div
                class="w-16 h-16 mx-auto mb-4 flex items-center justify-center bg-red-50 rounded-full"
              >
                <i class="ri-error-warning-line text-2xl text-red-500"></i>
              </div>
              <p class="text-gray-600 mb-2">Unable to load interests</p>
              <button
                class="text-primary text-sm hover:underline"
                onclick="loadInterests()"
              >
                Try again
              </button>
            </div>
            <!-- Empty state -->
            <div class="text-center py-4 hidden" id="interestsEmpty">
              <div
                class="w-16 h-16 mx-auto mb-4 flex items-center justify-center bg-gray-50 rounded-full"
              >
                <i class="ri-search-eye-line text-2xl text-gray-400"></i>
              </div>
              <p class="text-gray-600 mb-2">No new profile views yet</p>
              <p class="text-sm text-gray-500">
                Keep your profile updated to attract more employers!
              </p>
            </div>
            <!-- Data state -->
            <div class="hidden" id="interestsData">
              <div class="space-y-3 mb-4">
                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium text-gray-900"
                    >New views</span
                  >
                  <span class="text-sm text-primary font-medium" id="newViews"
                    >0</span
                  >
                </div>
              </div>
            </div>
          </div>
          <button
            class="w-full bg-[var(--primary-red)] hover:bg-[var(--primary-red-hover)] text-white py-2 rounded-button font-medium whitespace-nowrap btn"
            aria-label="View all employer interests"
          >
            View All Interests
          </button>
        </div>
        <!-- Messages Card -->
        <div class="bg-white rounded shadow-sm p-6" id="messagesCard">
          <div class="flex justify-between items-start mb-4">
            <div>
              <h2 class="text-lg font-semibold text-gray-900">Messages</h2>
              <p class="text-sm text-gray-500" id="unreadCount">
                Unread: Loading...
              </p>
            </div>
            <div
              class="w-8 h-8 flex items-center justify-center bg-primary/10 rounded-full"
            >
              <i class="ri-message-3-line text-primary"></i>
            </div>
          </div>
          <div id="messagesContent">
            <!-- Loading state -->
            <div class="text-center py-4" id="messagesLoading">
              <div
                class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto"
              ></div>
              <p class="text-sm text-gray-500 mt-2">Loading messages...</p>
            </div>
            <!-- Error state -->
            <div class="text-center py-4 hidden" id="messagesError">
              <div
                class="w-16 h-16 mx-auto mb-4 flex items-center justify-center bg-red-50 rounded-full"
              >
                <i class="ri-error-warning-line text-2xl text-red-500"></i>
              </div>
              <p class="text-gray-600 mb-2">Unable to load messages</p>
              <button
                class="text-primary text-sm hover:underline"
                onclick="loadMessages()"
              >
                Try again
              </button>
            </div>
            <!-- Empty state -->
            <div class="text-center py-4 hidden" id="messagesEmpty">
              <div
                class="w-16 h-16 mx-auto mb-4 flex items-center justify-center bg-gray-50 rounded-full"
              >
                <i class="ri-mail-open-line text-2xl text-gray-400"></i>
              </div>
              <p class="text-gray-600 mb-2">No new messages—hang tight!</p>
              <p class="text-sm text-gray-500">
                We'll notify you when employers reach out
              </p>
            </div>
            <!-- Data state -->
            <div class="hidden space-y-4" id="messagesData">
              <div class="latest-message p-3 bg-gray-50 rounded">
                <div class="flex items-center justify-between mb-2">
                  <span class="font-medium text-sm" id="latestEmployer"></span>
                  <span
                    class="text-xs text-gray-500"
                    id="latestTimestamp"
                  ></span>
                </div>
                <p
                  class="text-sm text-gray-600 line-clamp-2"
                  id="latestSnippet"
                ></p>
              </div>
            </div>
          </div>
          <div class="flex space-x-3 mt-4">
            <button
              class="flex-grow bg-[var(--primary-red)] hover:bg-[var(--primary-red-hover)] text-white py-2 rounded-button font-medium whitespace-nowrap btn"
              aria-label="View all messages"
            >
              View All Messages
            </button>
            <button
              class="flex items-center justify-center w-10 h-10 bg-gray-100 rounded-button btn"
              aria-label="Listen to messages"
            >
              <i class="ri-volume-up-line text-gray-600"></i>
            </button>
          </div>
        </div>
      </div>
      <!-- Visual Checklist -->
      <div class="card mb-8">
        <h2 class="section-title">Complete Your Profile</h2>
        <div class="flex flex-col">
          <!-- Stepper Header -->
          <div class="flex items-center justify-between mb-8">
            <!-- Step 1 -->
            <div class="flex flex-col items-center relative">
              <div
                class="w-12 h-12 rounded-full bg-primary flex items-center justify-center mb-2"
              >
                <i class="ri-file-upload-line text-white text-xl"></i>
              </div>
              <span class="text-sm font-medium text-primary text-center"
                >Upload Resume</span
              >
              <div
                class="absolute left-full top-6 w-full h-[2px] bg-primary"
              ></div>
            </div>
            <!-- Step 2 -->
            <div class="flex flex-col items-center relative">
              <div
                class="w-12 h-12 rounded-full bg-primary flex items-center justify-center mb-2"
              >
                <i class="ri-shield-check-line text-white text-xl"></i>
              </div>
              <span class="text-sm font-medium text-primary text-center"
                >Verify Clean Record</span
              >
              <div
                class="absolute left-full top-6 w-full h-[2px] bg-primary"
              ></div>
            </div>
            <!-- Step 3 -->
            <div class="flex flex-col items-center relative">
              <div
                class="w-12 h-12 rounded-full bg-primary flex items-center justify-center mb-2"
              >
                <i class="ri-file-shield-2-line text-white text-xl"></i>
              </div>
              <span class="text-sm font-medium text-primary text-center"
                >Polygraph Test</span
              >
              <div
                class="absolute left-full top-6 w-full h-[2px] bg-primary"
              ></div>
            </div>
            <!-- Step 4 -->
            <div class="flex flex-col items-center relative">
              <div
                class="w-12 h-12 rounded-full bg-primary flex items-center justify-center mb-2"
              >
                <i class="ri-map-pin-line text-white text-xl"></i>
              </div>
              <span class="text-sm font-medium text-primary text-center"
                >Preferred Location</span
              >
              <div
                class="absolute left-full top-6 w-full h-[2px] bg-primary"
              ></div>
            </div>
            <!-- Step 4 -->
            <div class="flex flex-col items-center">
              <div
                class="w-12 h-12 rounded-full bg-primary flex items-center justify-center mb-2"
              >
                <i class="ri-team-line text-white text-xl"></i>
              </div>
              <span class="text-sm font-medium text-primary text-center"
                >Add References</span
              >
            </div>
          </div>
          <!-- Step Content -->
          <div class="bg-white rounded-lg p-6 shadow-sm">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-lg font-medium text-gray-900">
                Complete Your Profile
              </h3>
              <button
                id="updateProfileBtn"
                class="bg-primary hover:bg-[var(--primary-red-hover)] text-white px-6 py-2 rounded-button text-sm flex items-center gap-2"
              >
                <i class="ri-save-line"></i>
                <span>Update Profile</span>
              </button>
            </div>
            <!-- Step 1 Content -->
            <div class="mb-8">
              <h3 class="text-lg font-medium text-gray-900 mb-4">
                Upload Your Resume
              </h3>
              <div class="flex flex-col items-center">
                <input
                  type="file"
                  id="cvUpload"
                  class="hidden"
                  accept=".pdf,.doc,.docx"
                />
                <button
                  onclick="document.getElementById('cvUpload').click()"
                  class="bg-white border border-gray-300 hover:border-primary text-gray-700 px-4 py-2 rounded-button text-sm flex items-center"
                >
                  <i class="ri-upload-2-line mr-2"></i>
                  <span>Choose File</span>
                </button>
                <span id="cvFileName" class="text-sm text-gray-500 mt-2"></span>
              </div>
            </div>
            <!-- Step 2 Content -->
            <div id="policeClearanceSection" class="mb-8 hidden">
              <h3 class="text-lg font-medium text-gray-900 mb-4">
                Upload Police Clearance
              </h3>
              <div class="flex flex-col items-center">
                <input
                  type="file"
                  id="policeClearanceUpload"
                  class="hidden"
                  accept=".pdf,image/*"
                />
                <button
                  onclick="document.getElementById('policeClearanceUpload').click()"
                  class="bg-white border border-gray-300 hover:border-primary text-gray-700 px-4 py-2 rounded-button text-sm flex items-center"
                >
                  <i class="ri-upload-2-line mr-2"></i>
                  <span>Choose File</span>
                </button>
                <span
                  id="selectedFileName"
                  class="text-sm text-gray-500 mt-2"
                ></span>
              </div>
            </div>
            <script>
              document.addEventListener("DOMContentLoaded", function () {
                const policeClearanceSection = document.getElementById(
                  "policeClearanceSection",
                );
                function updatePoliceClearanceVisibility() {
                  const userTier = sessionStorage.getItem("userTier") || "Bronze";
                  policeClearanceSection.classList.toggle(
                    "hidden",
                    !(userTier === "Silver" || userTier === "Gold"),
                  );
                }
                // Initial check
                updatePoliceClearanceVisibility();
                // Listen for tier changes
                window.addEventListener("userTierChanged", updatePoliceClearanceVisibility);
              });
            </script>
            <!-- Step 3 Content -->
            <div id="polygraphSection" class="mb-8 hidden">
              <h3 class="text-lg font-medium text-gray-900 mb-4">
                Upload Polygraph Test Results
              </h3>
              <div class="space-y-4">
                <div class="max-w-md mx-auto w-full">
                  <label class="block text-sm text-gray-600 mb-2"
                    >Test Date</label
                  >
                  <input
                    type="date"
                    id="polygraphDate"
                    class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm"
                    max="2025-06-22"
                  />
                </div>
                <div class="flex flex-col items-center mt-4">
                  <input
                    type="file"
                    id="polygraphUpload"
                    class="hidden"
                    accept=".pdf,.jpg,.jpeg"
                  />
                  <button
                    onclick="document.getElementById('polygraphUpload').click()"
                    class="bg-white border border-gray-300 hover:border-primary text-gray-700 px-4 py-2 rounded-button text-sm flex items-center"
                  >
                    <i class="ri-upload-2-line mr-2"></i>
                    <span>Upload Results</span>
                  </button>
                  <span
                    id="polygraphFileName"
                    class="text-sm text-gray-500 mt-2"
                  ></span>
                </div>
                <div class="flex justify-center mt-4">
                  <div
                    id="polygraphStatus"
                    class="inline-flex items-center px-3 py-1 rounded-full text-sm"
                  >
                    <i class="ri-time-line mr-1"></i>
                    <span>Pending Verification</span>
                  </div>
                </div>
                <div class="flex justify-center mt-4">
                  <button
                    id="verifyPolygraph"
                    class="bg-primary hover:bg-[var(--primary-red-hover)] text-white px-6 py-2 rounded-button text-sm flex items-center"
                  >
                    <i class="ri-shield-check-line mr-2"></i>
                    <span>Verify Now</span>
                  </button>
                </div>
              </div>
            </div>
            <script>
              document.addEventListener("DOMContentLoaded", function () {
                const polygraphSection = document.getElementById("polygraphSection");
                function updatePolygraphVisibility() {
                  const userTier = sessionStorage.getItem("userTier") || "Bronze";
                  polygraphSection.classList.toggle("hidden", userTier !== "Gold");
                }
                // Initial check
                updatePolygraphVisibility();
                // Listen for tier changes
                window.addEventListener("userTierChanged", updatePolygraphVisibility);
              });
            </script>
            <!-- Step 4 Content -->
            <div class="mb-8">
              <h3 class="text-lg font-medium text-gray-900 mb-4">
                Select Preferred Locations
              </h3>
              <div class="max-w-4xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="space-y-4">
                    <div class="relative">
                      <div class="flex items-center mb-2">
                        <label class="text-sm text-gray-600"
                          >Location Preferences</label
                        >
                        <div class="ml-auto flex items-center">
                          <button
                            id="toggleMapBtn"
                            class="text-xs text-primary hover:text-[var(--primary-red-hover)] flex items-center"
                          >
                            <i class="ri-map-pin-line mr-1"></i>
                            <span>Toggle Map</span>
                          </button>
                        </div>
                      </div>
                      <div class="space-y-4">
                        <select
                          id="provinceSelect"
                          class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm bg-white"
                        >
                          <option value="">Select Province</option>
                          <option value="Gauteng">Gauteng</option>
                          <option value="Western Cape">Western Cape</option>
                          <option value="Eastern Cape">Eastern Cape</option>
                          <option value="KwaZulu-Natal">KwaZulu-Natal</option>
                          <option value="Free State">Free State</option>
                          <option value="Limpopo">Limpopo</option>
                          <option value="Mpumalanga">Mpumalanga</option>
                          <option value="North West">North West</option>
                          <option value="Northern Cape">Northern Cape</option>
                        </select>
                        <div class="relative">
                          <div
                            class="flex items-center border border-gray-300 rounded-button overflow-hidden"
                          >
                            <i class="ri-search-line text-gray-400 ml-3"></i>
                            <input
                              type="text"
                              id="locationSearch"
                              class="w-full px-3 py-2 text-sm border-none focus:ring-0"
                              placeholder="Search cities and suburbs..."
                            />
                          </div>
                          <ul
                            id="locationResults"
                            class="absolute w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-48 overflow-y-auto hidden z-10"
                          ></ul>
                        </div>
                        <div
                          id="selectedLocations"
                          class="flex flex-wrap gap-2"
                        ></div>
                      </div>
                      <!-- Province Select -->
                      <div class="mb-4">
                        <select
                          id="provinceSelect"
                          class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm bg-white"
                        >
                          <option value="">Select Province</option>
                        </select>
                      </div>
                      <!-- Location Multi-select -->
                      <div
                        id="locationMultiSelect"
                        class="w-full bg-white border border-gray-300 rounded-button cursor-pointer"
                      >
                        <div
                          class="flex items-center p-2 gap-2 flex-wrap min-h-[40px]"
                          id="selectedTags"
                        ></div>
                        <div
                          class="relative flex items-center border-t border-gray-200"
                        >
                          <i
                            class="ri-search-line text-gray-400 absolute left-3"
                          ></i>
                          <input
                            type="text"
                            id="locationSearch"
                            class="w-full pl-10 pr-3 py-2 text-sm"
                            placeholder="Search cities and suburbs..."
                          />
                        </div>
                        <div
                          class="absolute w-full bg-white border border-gray-200 rounded-lg shadow-lg mt-1 max-h-64 overflow-y-auto hidden z-10"
                          id="locationOptions"
                        >
                          <div
                            class="sticky top-0 bg-gray-50 p-2 border-b border-gray-200"
                          >
                            <div class="flex gap-2">
                              <button
                                class="px-3 py-1 text-xs rounded-full bg-white border border-gray-200 hover:border-primary text-gray-600 hover:text-primary active"
                                data-filter="all"
                              >
                                All
                              </button>
                              <button
                                class="px-3 py-1 text-xs rounded-full bg-white border border-gray-200 hover:border-primary text-gray-600 hover:text-primary"
                                data-filter="city"
                              >
                                Cities
                              </button>
                              <button
                                class="px-3 py-1 text-xs rounded-full bg-white border border-gray-200 hover:border-primary text-gray-600 hover:text-primary"
                                data-filter="suburb"
                              >
                                Suburbs
                              </button>
                            </div>
                          </div>
                          <div class="p-2" id="locationOptionsContent"></div>
                        </div>
                      </div>
                    </div>
                    <div class="space-y-4">
                      <div>
                        <label class="text-sm text-gray-600 mb-2 block"
                          >Postal Code (Optional)</label
                        >
                        <input
                          type="text"
                          id="postalCode"
                          class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm"
                          placeholder="Enter postal code"
                          maxlength="4"
                          pattern="[0-9]*"
                        />
                      </div>
                      <div>
                        <label class="text-sm text-gray-600 mb-2 block"
                          >Max Travel Distance</label
                        >
                        <div class="relative">
                          <input
                            type="number"
                            id="maxTravelDistance"
                            class="w-full pl-3 pr-12 py-2 border border-gray-300 rounded-button text-sm"
                            min="0"
                            max="200"
                            placeholder="Enter distance"
                          />
                          <div
                            class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"
                          >
                            <span class="text-sm text-gray-500">km</span>
                          </div>
                        </div>
                      </div>
                      <div
                        class="flex items-center justify-between bg-gray-50 p-3 rounded-lg"
                      >
                        <span class="text-sm text-gray-700"
                          >Willing to relocate</span
                        >
                        <label class="switch">
                          <input type="checkbox" id="relocateToggle" />
                          <span class="slider"></span>
                        </label>
                      </div>
                    </div>
                  </div>
                  <div class="mt-6">
                    <div
                      id="mapContainer"
                      class="hidden w-full h-[300px] rounded-lg overflow-hidden relative"
                    >
                      <img
                        src="https://public.readdy.ai/gen_page/map_placeholder_1280x720.png"
                        alt="Map"
                        class="w-full h-full object-cover"
                      />
                      <div
                        id="radiusCircle"
                        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full border-2 border-primary/50 bg-primary/10 pointer-events-none"
                      ></div>
                      <div
                        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 bg-primary rounded-full flex items-center justify-center shadow-lg"
                      >
                        <i class="ri-map-pin-fill text-white"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- Step 4 Content -->
              <div>
                <h3 class="text-lg font-medium text-gray-900 mb-4">
                  Add References
                </h3>
                <div
                  class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto"
                >
                  <!-- Reference 1 -->
                  <div class="space-y-4">
                    <h4 class="font-medium text-gray-700">Reference 1</h4>
                    <div>
                      <input
                        type="text"
                        id="ref1Name"
                        class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm"
                        placeholder="Reference Name"
                      />
                      <div
                        id="ref1NameError"
                        class="text-red-500 text-xs mt-1 hidden"
                      >
                        Reference name is required
                      </div>
                    </div>
                    <div>
                      <input
                        type="tel"
                        id="ref1Phone"
                        class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm"
                        placeholder="Reference Phone"
                      />
                      <div
                        id="ref1PhoneError"
                        class="text-red-500 text-xs mt-1 hidden"
                      >
                        Please enter a valid phone number
                      </div>
                    </div>
                  </div>
                  <!-- Reference 2 -->
                  <div class="space-y-3">
                    <h4 class="font-medium text-gray-700">
                      Reference 2 (Optional)
                    </h4>
                    <div>
                      <input
                        type="text"
                        id="ref2Name"
                        class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm"
                        placeholder="Reference Name"
                      />
                    </div>
                    <div>
                      <input
                        type="tel"
                        id="ref2Phone"
                        class="w-full px-3 py-2 border border-gray-300 rounded-button text-sm"
                        placeholder="Reference Phone"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <script id="locationScript">
            document.addEventListener("DOMContentLoaded", function () {
              const cities = [
                { name: "Johannesburg", province: "Gauteng" },
                { name: "Pretoria", province: "Gauteng" },
                { name: "Sandton", province: "Gauteng" },
                { name: "Cape Town", province: "Western Cape" },
                { name: "Stellenbosch", province: "Western Cape" },
                { name: "Durban", province: "KwaZulu-Natal" },
                { name: "Pietermaritzburg", province: "KwaZulu-Natal" },
                { name: "Port Elizabeth", province: "Eastern Cape" },
                { name: "East London", province: "Eastern Cape" },
                { name: "Bloemfontein", province: "Free State" },
                { name: "Welkom", province: "Free State" },
                { name: "Polokwane", province: "Limpopo" },
                { name: "Tzaneen", province: "Limpopo" },
                { name: "Nelspruit", province: "Mpumalanga" },
                { name: "Witbank", province: "Mpumalanga" },
                { name: "Rustenburg", province: "North West" },
                { name: "Klerksdorp", province: "North West" },
                { name: "Kimberley", province: "Northern Cape" },
                { name: "Upington", province: "Northern Cape" },
              ];
              let selectedProvince = "";
              let selectedLocations = [];
              const provinceSelect = document.getElementById("provinceSelect");
              const locationSearch = document.getElementById("locationSearch");
              const locationResults = document.getElementById("locationResults");
              const selectedLocationsContainer =
                document.getElementById("selectedLocations");
              provinceSelect.addEventListener("change", function (e) {
                selectedProvince = e.target.value;
                filterLocations("");
              });
              locationSearch.addEventListener("input", function (e) {
                const searchTerm = e.target.value.toLowerCase();
                filterLocations(searchTerm);
                locationResults.classList.remove("hidden");
              });
              document.addEventListener("click", function (e) {
                if (
                  !locationSearch.contains(e.target) &&
                  !locationResults.contains(e.target)
                ) {
                  locationResults.classList.add("hidden");
                }
              });
              function filterLocations(searchTerm) {
                locationResults.innerHTML = "";
                if (!selectedProvince) return;
                const filteredCities = cities.filter(
                  (city) =>
                    city.province === selectedProvince &&
                    city.name.toLowerCase().includes(searchTerm),
                );
                if (filteredCities.length === 0) {
                  locationResults.innerHTML =
                    '<div class="p-3 text-sm text-gray-500 text-center">No locations found</div>';
                  return;
                }
                filteredCities.forEach((city) => {
                  const item = document.createElement("li");
                  item.className = "px-3 py-2 hover:bg-gray-50 cursor-pointer text-sm";
                  item.textContent = city.name;
                  item.onclick = () => addLocation(city);
                  locationResults.appendChild(item);
                });
                locationResults.classList.remove("hidden");
              }
              function addLocation(city) {
                if (!selectedLocations.find((loc) => loc.name === city.name)) {
                  selectedLocations.push(city);
                  updateSelectedLocations();
                }
                locationSearch.value = "";
                locationResults.classList.add("hidden");
              }
              function removeLocation(cityName) {
                selectedLocations = selectedLocations.filter(
                  (city) => city.name !== cityName,
                );
                updateSelectedLocations();
              }
              function updateSelectedLocations() {
                selectedLocationsContainer.innerHTML = "";
                selectedLocations.forEach((city) => {
                  const tag = document.createElement("div");
                  tag.className =
                    "bg-gray-100 rounded-full px-3 py-1 text-sm flex items-center gap-2";
                  tag.innerHTML = `
            <span>${city.name}</span>
            <button class="hover:text-primary" onclick="removeLocation('${city.name}')">
            <i class="ri-close-line"></i>
            </button>
            `;
                  selectedLocationsContainer.appendChild(tag);
                });
              }
              const multiSelect = document.getElementById("locationMultiSelect");
              const selectedTags = document.getElementById("selectedTags");
              const locationOptions = document.getElementById("locationOptions");
              const searchInput = multiSelect.querySelector("input");
              let currentUser = {
                locations: [],
              };
              function createLocationList(filter = "") {
                locationOptionsContent.innerHTML = "";
                const searchTerm = filter.toLowerCase();
                function createLocationItem(location, type) {
                  if (!location.toLowerCase().includes(searchTerm)) return null;
                  const div = document.createElement("div");
                  div.className =
                    "p-2 hover:bg-gray-50 cursor-pointer text-sm flex items-center justify-between group";
                  div.innerHTML = `
            <span>${location}</span>
            <span class="text-xs text-gray-400 opacity-0 group-hover:opacity-100">${type}</span>
            `;
                  div.onclick = () => selectLocation(location, type);
                  return div;
                }
                if (
                  currentUser.currentFilter === "all" ||
                  currentUser.currentFilter === "province"
                ) {
                  locations.provinces.forEach((province) => {
                    const item = createLocationItem(province, "Province");
                    if (item) locationOptionsContent.appendChild(item);
                  });
                }
                if (
                  currentUser.currentFilter === "all" ||
                  currentUser.currentFilter === "metro"
                ) {
                  locations.metros.forEach((metro) => {
                    const item = createLocationItem(metro, "Metro");
                    if (item) locationOptionsContent.appendChild(item);
                  });
                }
                if (
                  currentUser.currentFilter === "all" ||
                  currentUser.currentFilter === "suburb"
                ) {
                  Object.values(locations.suburbs)
                    .flat()
                    .forEach((suburb) => {
                      const item = createLocationItem(suburb, "Suburb");
                      if (item) locationOptionsContent.appendChild(item);
                    });
                }
                if (locationOptionsContent.children.length === 0) {
                  const noResults = document.createElement("div");
                  noResults.className = "p-4 text-center text-sm text-gray-500";
                  noResults.textContent = "No locations found";
                  locationOptionsContent.appendChild(noResults);
                }
              }
              function selectLocation(location) {
                if (!currentUser.locations.includes(location)) {
                  currentUser.locations.push(location);
                  updateTags();
                  saveLocations();
                }
                locationOptions.classList.add("hidden");
                searchInput.value = "";
              }
              function updateTags() {
                selectedTags.innerHTML = "";
                currentUser.locations.forEach((location) => {
                  const tag = document.createElement("div");
                  tag.className =
                    "bg-gray-100 hover:bg-gray-200 rounded-full px-3 py-1.5 text-sm flex items-center gap-2 transition-colors";
                  tag.innerHTML = `
            <span class="truncate max-w-[150px]">${location}</span>
            <button class="w-4 h-4 flex items-center justify-center hover:text-primary" onclick="removeLocation('${location}')">
            <i class="ri-close-line"></i>
            </button>
            `;
                  selectedTags.appendChild(tag);
                });
                if (currentUser.locations.length === 0) {
                  const placeholder = document.createElement("div");
                  placeholder.className = "text-sm text-gray-400 px-1";
                  placeholder.textContent = "No locations selected";
                  selectedTags.appendChild(placeholder);
                }
              }
              window.removeLocation = function (location) {
                currentUser.locations = currentUser.locations.filter(
                  (loc) => loc !== location,
                );
                updateTags();
                saveLocations();
              };
              function saveLocations() {
                fetch("/api/save-locations", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify({
                    locations: currentUser.locations,
                  }),
                });
              }
              multiSelect.addEventListener("click", () => {
                locationOptions.classList.toggle("hidden");
                if (!locationOptions.classList.contains("hidden")) {
                  createLocationList();
                  searchInput.focus();
                }
              });
              searchInput.addEventListener("input", (e) => {
                createLocationList(e.target.value);
                locationOptions.classList.remove("hidden");
              });
              document.addEventListener("click", (e) => {
                if (!multiSelect.contains(e.target)) {
                  locationOptions.classList.add("hidden");
                }
              });
              createLocationList();
            });
          </script>
        </div>
      </div>
      <!-- Help & Support -->
      <div class="card">
        <h2 class="section-title">Help & Support</h2>
        <div class="grid grid-cols-1 md:grid-cols-1 gap-4">
          <div class="border border-gray-200 rounded p-4">
            <div class="flex items-start">
              <div
                class="w-10 h-10 flex items-center justify-center bg-primary/10 rounded-full flex-shrink-0"
              >
                <i class="ri-notification-line text-primary"></i>
              </div>
              <div class="ml-3">
                <h3 class="font-medium text-gray-900">
                  Notification Preferences
                </h3>
                <p class="text-sm text-gray-600 mt-1">
                  Choose how you want to receive notifications
                </p>
                <div class="flex flex-col mt-3 space-y-2">
                  <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-700">SMS Notifications</span>
                    <label class="switch">
                      <input type="checkbox" checked />
                      <span class="slider"></span>
                    </label>
                  </div>
                  <div class="flex items-center justify-between">
                    <span class="text-sm text-gray-700"
                      >WhatsApp Notifications</span
                    >
                    <label class="switch">
                      <input type="checkbox" />
                      <span class="slider"></span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <!-- Bottom Tab Bar (Mobile) -->
    <div
      class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50"
    >
      <div class="flex justify-around">
        <a href="#" class="flex flex-col items-center py-2 px-3 text-primary">
          <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-home-5-fill"></i>
          </div>
          <span class="text-xs mt-1">Home</span>
        </a>
        <a href="#" class="flex flex-col items-center py-2 px-3 text-gray-500">
          <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-bookmark-line"></i>
          </div>
          <span class="text-xs mt-1">Saved</span>
        </a>
        <a href="#" class="flex flex-col items-center py-2 px-3 text-gray-500">
          <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-message-3-line"></i>
          </div>
          <span class="text-xs mt-1">Messages</span>
        </a>
        <a href="#" class="flex flex-col items-center py-2 px-3 text-gray-500">
          <div class="w-6 h-6 flex items-center justify-center">
            <i class="ri-user-line"></i>
          </div>
          <span class="text-xs mt-1">Profile</span>
        </a>
      </div>
    </div>
    <!-- Help Button -->
    <div class="fixed bottom-6 right-6 z-50">
      <button
        class="w-14 h-14 bg-primary rounded-full shadow-lg flex items-center justify-center text-white"
      >
        <i class="ri-question-line text-xl"></i>
      </button>
    </div>
    <!-- Network Status Banner (Hidden by default) -->
    <div
      id="networkBanner"
      class="fixed top-16 left-0 right-0 bg-green-100 text-green-800 px-4 py-2 text-sm hidden z-40"
    >
      <div class="container mx-auto flex items-center">
        <div class="w-5 h-5 flex items-center justify-center mr-2">
          <i class="ri-wifi-line"></i>
        </div>
        <span>Back online - All features available</span>
      </div>
    </div>
    <script id="userMenuScript">
      document.addEventListener("DOMContentLoaded", function () {
        const userMenuButton = document.getElementById("userMenuButton");
        const userMenu = document.getElementById("userMenu");
        const userName = document.getElementById("userName");
        const userRole = document.getElementById("userRole");
        const welcomeName = document.getElementById("welcomeName");
        const logoutLink = document.getElementById("logoutLink");
        const logoutDialog = document.getElementById("logoutDialog");
        const cancelLogout = document.getElementById("cancelLogout");
        const confirmLogout = document.getElementById("confirmLogout");
        function loadUserData() {
          const registrationData = {
            name: sessionStorage.getItem("userName") || "Guest",
            role: sessionStorage.getItem("userRole") || "Job Seeker",
          };
          userName.textContent = registrationData.name;
          userRole.textContent = registrationData.role;
          welcomeName.textContent = registrationData.name;
        }
        function handleLogout() {
          sessionStorage.removeItem("token");
          sessionStorage.removeItem("userName");
          sessionStorage.removeItem("userRole");
          window.location.href = "/login";
        }
        loadUserData();
        userMenuButton.addEventListener("click", function () {
          userMenu.classList.toggle("hidden");
        });
        document.addEventListener("click", function (event) {
          if (
            !userMenuButton.contains(event.target) &&
            !userMenu.contains(event.target)
          ) {
            userMenu.classList.add("hidden");
          }
        });
        logoutLink.addEventListener("click", function (e) {
          e.preventDefault();
          logoutDialog.classList.remove("hidden");
        });
        cancelLogout.addEventListener("click", function () {
          logoutDialog.classList.add("hidden");
        });
        confirmLogout.addEventListener("click", function (e) {
          e.preventDefault();
          window.location.href =
            "https://readdy.ai/home/c14c6ca2-d668-408a-94aa-6976679ad86b/0c4af476-1405-4543-b628-417302d1465c";
        });
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape" && !logoutDialog.classList.contains("hidden")) {
            logoutDialog.classList.add("hidden");
          }
        });
        logoutDialog.addEventListener("click", function (e) {
          if (e.target === logoutDialog) {
            logoutDialog.classList.add("hidden");
          }
        });
      });
    </script>
    <script id="networkStatusScript">
      document.addEventListener("DOMContentLoaded", function () {
        const networkBanner = document.getElementById("networkBanner");
        function updateOnlineStatus() {
          networkBanner.classList.remove("hidden");
          if (navigator.onLine) {
            networkBanner.classList.add("bg-green-100", "text-green-800");
            networkBanner.querySelector("i").className = "ri-wifi-line";
            networkBanner.querySelector("span").textContent =
              "Back online - All features available";
          } else {
            networkBanner.classList.add("bg-yellow-100", "text-yellow-800");
            networkBanner.querySelector("i").className = "ri-wifi-off-line";
            networkBanner.querySelector("span").textContent =
              "You're offline. Some features may be limited.";
          }
          setTimeout(() => {
            networkBanner.classList.add("hidden");
          }, 3000);
        }
        window.addEventListener("online", updateOnlineStatus);
        window.addEventListener("offline", updateOnlineStatus);
        // Initial check
        updateOnlineStatus();
      });
    </script>
    <script id="apiScript">
      document.addEventListener("DOMContentLoaded", function () {
        const API_BASE_URL = "/api/jobseeker";

        function buildProfileData() {
          return {
            resume: {
              fileName: document.getElementById("cvFileName").textContent || null,
            },
            policeClearance: {
              fileName:
                document.getElementById("selectedFileName")?.textContent || null,
            },
            polygraphTest: {
              fileName:
                document.getElementById("polygraphFileName")?.textContent || null,
              testDate: document.getElementById("polygraphDate")?.value || null,
              status: document
                .getElementById("polygraphStatus")
                ?.classList.contains("verified")
                ? "verified"
                : "pending",
            },
            locations: {
              province: document.getElementById("provinceSelect")?.value || null,
              selectedLocations: currentUser.locations || [],
              postalCode: document.getElementById("postalCode")?.value || null,
              maxTravelDistance:
                document.getElementById("maxTravelDistance")?.value || null,
              willingToRelocate:
                document.getElementById("relocateToggle")?.checked || false,
            },
            references: {
              reference1: {
                name: document.getElementById("ref1Name")?.value || null,
                phone: document.getElementById("ref1Phone")?.value || null,
              },
              reference2: {
                name: document.getElementById("ref2Name")?.value || null,
                phone: document.getElementById("ref2Phone")?.value || null,
              },
            },
            notifications: {
              sms:
                document.querySelector('.switch input[type="checkbox"]:first-of-type')
                  ?.checked || false,
              whatsapp:
                document.querySelector('.switch input[type="checkbox"]:last-of-type')
                  ?.checked || false,
            },
          };
        }

        const updateProfileBtn = document.getElementById("updateProfileBtn");
        updateProfileBtn.addEventListener("click", async function () {
          try {
            const profileData = buildProfileData();

            // Disable button and show loading state
            updateProfileBtn.disabled = true;
            const btnText = updateProfileBtn.querySelector("span");
            const originalText = btnText.textContent;
            btnText.textContent = "Saving...";

            const response = await fetch("/api/profile", {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${sessionStorage.getItem("token")}`,
              },
              body: JSON.stringify(profileData),
            });

            if (!response.ok) throw new Error("Failed to update profile");

            showToast("Profile updated successfully");
            loadVerificationStatus();
          } catch (error) {
            console.error("Profile update failed:", error);
            showToast("Failed to update profile. Please try again.");
          } finally {
            // Restore button state
            updateProfileBtn.disabled = false;
            const btnText = updateProfileBtn.querySelector("span");
            btnText.textContent = "Update Profile";
          }
        });
        const upgradeSilverBtn = document.getElementById("upgradeSilverBtn");
        const upgradeDialog = document.getElementById("upgradeDialog");
        const closeUpgradeDialog = document.getElementById("closeUpgradeDialog");
        const cancelUpgrade = document.getElementById("cancelUpgrade");
        const confirmUpgrade = document.getElementById("confirmUpgrade");
        function showUpgradeDialog() {
          upgradeDialog.classList.remove("hidden");
          document.body.style.overflow = "hidden";
        }
        function hideUpgradeDialog() {
          upgradeDialog.classList.add("hidden");
          document.body.style.overflow = "";
        }
        upgradeSilverBtn.addEventListener("click", showUpgradeDialog);
        closeUpgradeDialog.addEventListener("click", hideUpgradeDialog);
        cancelUpgrade.addEventListener("click", hideUpgradeDialog);
        upgradeDialog.addEventListener("click", function (e) {
          if (e.target === upgradeDialog) {
            hideUpgradeDialog();
          }
        });
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape" && !upgradeDialog.classList.contains("hidden")) {
            hideUpgradeDialog();
          }
        });
        function showUpgradeDialog() {
          upgradeDialog.classList.remove("hidden");
        }
        function hideUpgradeDialog() {
          upgradeDialog.classList.add("hidden");
        }
        async function handleUpgrade() {
          try {
            await fetchWithRetry(`${API_BASE_URL}/${JOBSEEKER_ID}/upgrade`, {
              method: "POST",
              body: JSON.stringify({
                tier: "Silver",
              }),
            });
            sessionStorage.setItem("userTier", "Silver");
            window.dispatchEvent(new Event("userTierChanged"));
            showToast("Successfully upgraded to Silver tier!");
            hideUpgradeDialog();
            const policeClearanceSection = document.getElementById(
              "policeClearanceSection",
            );
            if (policeClearanceSection) {
              policeClearanceSection.classList.remove("hidden");
            }
          } catch (error) {
            console.error("Upgrade failed:", error);
            showToast("Failed to upgrade. Please try again.");
          }
        }
        upgradeSilverBtn.addEventListener("click", showUpgradeDialog);
        closeUpgradeDialog.addEventListener("click", hideUpgradeDialog);
        cancelUpgrade.addEventListener("click", hideUpgradeDialog);
        confirmUpgrade.addEventListener("click", handleUpgrade);
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape" && !upgradeDialog.classList.contains("hidden")) {
            hideUpgradeDialog();
          }
        });
        upgradeDialog.addEventListener("click", function (e) {
          if (e.target === upgradeDialog) {
            hideUpgradeDialog();
          }
        });
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape" && !upgradeDialog.classList.contains("hidden")) {
            hideUpgradeDialog();
          }
        });
        upgradeDialog.addEventListener("click", function (e) {
          if (e.target === upgradeDialog) {
            hideUpgradeDialog();
          }
        });
        const relocateToggle = document.getElementById("relocateToggle");
        relocateToggle.addEventListener("change", async function (e) {
          try {
            await fetchWithRetry(`${API_BASE_URL}/${JOBSEEKER_ID}/preferences`, {
              method: "POST",
              body: JSON.stringify({
                willingToRelocate: e.target.checked,
              }),
            });
            showToast(
              `Relocation preference ${e.target.checked ? "enabled" : "disabled"}`,
            );
          } catch (error) {
            console.error("Failed to update relocation preference:", error);
            showToast("Failed to update preference. Please try again.");
            e.target.checked = !e.target.checked;
          }
        });
        const polygraphUpload = document.getElementById("polygraphUpload");
        const polygraphFileName = document.getElementById("polygraphFileName");
        const polygraphStatus = document.getElementById("polygraphStatus");
        const verifyPolygraph = document.getElementById("verifyPolygraph");
        const polygraphDate = document.getElementById("polygraphDate");
        polygraphDate.max = new Date().toISOString().split("T")[0];
        polygraphUpload.addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const validTypes = [".pdf", ".jpg", ".jpeg"];
            const fileExtension = "." + file.name.split(".").pop().toLowerCase();
            if (!validTypes.includes(fileExtension)) {
              showToast("Please upload a PDF or JPG file");
              polygraphUpload.value = "";
              return;
            }
            polygraphFileName.textContent = file.name;
            const formData = new FormData();
            formData.append("polygraph", file);
            formData.append("testDate", polygraphDate.value);
            fetch(`${API_BASE_URL}/${JOBSEEKER_ID}/upload-polygraph`, {
              method: "POST",
              body: formData,
              headers: {
                Authorization: `Bearer ${sessionStorage.getItem("token")}`,
              },
            })
              .then((response) => {
                if (!response.ok) throw new Error("Upload failed");
                return response.json();
              })
              .then(() => {
                showToast("Polygraph test results uploaded successfully");
                polygraphStatus.innerHTML =
                  '<i class="ri-time-line mr-1"></i><span>Pending Verification</span>';
                polygraphStatus.className =
                  "inline-flex items-center px-3 py-1 rounded-full text-sm bg-yellow-100 text-yellow-800";
                loadVerificationStatus();
              })
              .catch((error) => {
                console.error("Upload error:", error);
                showToast("Failed to upload document. Please try again.");
                polygraphFileName.textContent = "";
                polygraphUpload.value = "";
              });
          }
        });
        verifyPolygraph.addEventListener("click", function () {
          if (!polygraphFileName.textContent || !polygraphDate.value) {
            showToast("Please upload polygraph results and select test date first");
            return;
          }
          fetch(`${API_BASE_URL}/verify/polygraph`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${sessionStorage.getItem("token")}`,
            },
            body: JSON.stringify({
              fileName: polygraphFileName.textContent,
              testDate: polygraphDate.value,
            }),
          })
            .then((response) => {
              if (!response.ok) throw new Error("Verification failed");
              return response.json();
            })
            .then(() => {
              polygraphStatus.innerHTML =
                '<i class="ri-checkbox-circle-line mr-1"></i><span>Verified</span>';
              polygraphStatus.className =
                "inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800 verified";
              showToast("Polygraph test verified successfully");
              loadVerificationStatus();
            })
            .catch((error) => {
              console.error("Verification error:", error);
              showToast("Failed to verify polygraph test. Please try again.");
            });
        });
        // References validation
        const ref1Name = document.getElementById("ref1Name");
        const ref1Phone = document.getElementById("ref1Phone");
        const ref1NameError = document.getElementById("ref1NameError");
        const ref1PhoneError = document.getElementById("ref1PhoneError");
        function validateReference1() {
          let isValid = true;
          // Validate Reference 1 Name
          if (!ref1Name.value.trim()) {
            ref1NameError.classList.remove("hidden");
            ref1Name.classList.add("border-red-500");
            isValid = false;
          } else {
            ref1NameError.classList.add("hidden");
            ref1Name.classList.remove("border-red-500");
          }
          // Validate Reference 1 Phone
          const phoneRegex = /^[\d\s\-\+\(\)]{10,}$/;
          if (!phoneRegex.test(ref1Phone.value.trim())) {
            ref1PhoneError.classList.remove("hidden");
            ref1Phone.classList.add("border-red-500");
            isValid = false;
          } else {
            ref1PhoneError.classList.add("hidden");
            ref1Phone.classList.remove("border-red-500");
          }
          return isValid;
        }
        // Add event listeners for real-time validation
        ref1Name.addEventListener("blur", validateReference1);
        ref1Phone.addEventListener("blur", validateReference1);
        // Save references
        async function saveReferences() {
          if (!validateReference1()) return;
          try {
            const references = {
              reference1: {
                name: ref1Name.value.trim(),
                phone: ref1Phone.value.trim(),
              },
              reference2: {
                name: document.getElementById("ref2Name").value.trim(),
                phone: document.getElementById("ref2Phone").value.trim(),
              },
            };
            await fetchWithRetry(`${API_BASE_URL}/${JOBSEEKER_ID}/references`, {
              method: "POST",
              body: JSON.stringify(references),
            });
            showToast("References saved successfully");
            loadVerificationStatus();
          } catch (error) {
            console.error("Failed to save references:", error);
            showToast("Failed to save references. Please try again.");
          }
        }
        // Add input event listeners
        [ref1Name, ref1Phone, "ref2Name", "ref2Phone"].forEach((id) => {
          const element = typeof id === "string" ? document.getElementById(id) : id;
          element.addEventListener("change", saveReferences);
        });
        const locationData = {
          provinces: [
            "Gauteng",
            "Western Cape",
            "Eastern Cape",
            "KwaZulu-Natal",
            "Free State",
            "Limpopo",
            "Mpumalanga",
            "North West",
            "Northern Cape",
          ],
          cities: {
            Gauteng: [
              "Johannesburg",
              "Pretoria",
              "Ekurhuleni",
              "Midrand",
              "Centurion",
            ],
            "Western Cape": [
              "Cape Town",
              "Stellenbosch",
              "Paarl",
              "George",
              "Knysna",
            ],
            "KwaZulu-Natal": [
              "Durban",
              "Pietermaritzburg",
              "Newcastle",
              "Richards Bay",
              "Port Shepstone",
            ],
            "Eastern Cape": [
              "Port Elizabeth",
              "East London",
              "Mthatha",
              "Grahamstown",
              "Uitenhage",
            ],
            "Free State": [
              "Bloemfontein",
              "Welkom",
              "Bethlehem",
              "Sasolburg",
              "Parys",
            ],
            Limpopo: [
              "Polokwane",
              "Tzaneen",
              "Mokopane",
              "Thohoyandou",
              "Louis Trichardt",
            ],
            Mpumalanga: ["Nelspruit", "Witbank", "Secunda", "Middelburg", "Ermelo"],
            "North West": [
              "Rustenburg",
              "Klerksdorp",
              "Potchefstroom",
              "Mahikeng",
              "Brits",
            ],
            "Northern Cape": [
              "Kimberley",
              "Upington",
              "Kuruman",
              "De Aar",
              "Springbok",
            ],
          },
          suburbs: {
            Johannesburg: [
              "Sandton",
              "Rosebank",
              "Randburg",
              "Fourways",
              "Bryanston",
            ],
            "Cape Town": [
              "Sea Point",
              "Green Point",
              "Camps Bay",
              "Claremont",
              "Constantia",
            ],
            Durban: ["Umhlanga", "Ballito", "Morningside", "Berea", "Westville"],
          },
        };
        const provinceSelect = document.getElementById("provinceSelect");
        const locationSearch = document.getElementById("locationSearch");
        let currentState = {
          selectedProvince: "",
          selectedLocations: [],
          currentFilter: "all",
          searchTerm: "",
        };
        // Initialize province select
        function initProvinceSelect() {
          locationData.provinces.forEach((province) => {
            const option = document.createElement("option");
            option.value = province;
            option.textContent = province;
            provinceSelect.appendChild(option);
          });
        }
        // Filter locations based on province and search term
        function filterLocations() {
          const searchTerm = locationSearch.value.toLowerCase();
          let filteredItems = [];
          if (currentState.selectedProvince) {
            if (
              currentState.currentFilter === "all" ||
              currentState.currentFilter === "city"
            ) {
              const cities = locationData.cities[currentState.selectedProvince] || [];
              filteredItems = filteredItems.concat(
                cities.filter((city) => city.toLowerCase().includes(searchTerm)),
              );
            }
            if (
              currentState.currentFilter === "all" ||
              currentState.currentFilter === "suburb"
            ) {
              const citiesInProvince =
                locationData.cities[currentState.selectedProvince] || [];
              citiesInProvince.forEach((city) => {
                const suburbs = locationData.suburbs[city] || [];
                filteredItems = filteredItems.concat(
                  suburbs.filter((suburb) =>
                    suburb.toLowerCase().includes(searchTerm),
                  ),
                );
              });
            }
          }
          return filteredItems;
        }
        // Update location options display
        function updateLocationOptions() {
          locationOptionsContent.innerHTML = "";
          const filteredLocations = filterLocations();
          if (filteredLocations.length === 0) {
            const noResults = document.createElement("div");
            noResults.className = "p-4 text-center text-sm text-gray-500";
            noResults.textContent = "No locations found";
            locationOptionsContent.appendChild(noResults);
            return;
          }
          filteredLocations.forEach((location) => {
            const item = document.createElement("div");
            item.className =
              "p-2 hover:bg-gray-50 cursor-pointer text-sm flex items-center justify-between group";
            item.innerHTML = `
      <span>${location}</span>
      <span class="text-xs text-gray-400 opacity-0 group-hover:opacity-100">
      ${locationData.suburbs[location] ? "City" : "Suburb"}
      </span>
      `;
            item.onclick = () => selectLocation(location);
            locationOptionsContent.appendChild(item);
          });
        }
        // Handle location selection
        function selectLocation(location) {
          if (!currentState.selectedLocations.includes(location)) {
            currentState.selectedLocations.push(location);
            updateTags();
            saveLocationPreferences();
          }
          locationOptions.classList.add("hidden");
          locationSearch.value = "";
          currentState.searchTerm = "";
        }
        // Update selected location tags
        function updateTags() {
          selectedTags.innerHTML = "";
          if (currentState.selectedLocations.length === 0) {
            const placeholder = document.createElement("div");
            placeholder.className = "text-sm text-gray-400 px-1";
            placeholder.textContent = "No locations selected";
            selectedTags.appendChild(placeholder);
            return;
          }
          currentState.selectedLocations.forEach((location) => {
            const tag = document.createElement("div");
            tag.className =
              "bg-gray-100 hover:bg-gray-200 rounded-full px-3 py-1.5 text-sm flex items-center gap-2 transition-colors";
            tag.innerHTML = `
      <span class="truncate max-w-[150px]">${location}</span>
      <button class="w-4 h-4 flex items-center justify-center hover:text-primary" onclick="removeLocation('${location}')">
      <i class="ri-close-line"></i>
      </button>
      `;
            selectedTags.appendChild(tag);
          });
        }
        // Remove selected location
        window.removeLocation = function (location) {
          currentState.selectedLocations = currentState.selectedLocations.filter(
            (loc) => loc !== location,
          );
          updateTags();
          saveLocationPreferences();
        };
        // Event Listeners
        provinceSelect.addEventListener("change", (e) => {
          currentState.selectedProvince = e.target.value;
          currentState.selectedLocations = [];
          updateTags();
          updateLocationOptions();
        });
        locationSearch.addEventListener("input", (e) => {
          currentState.searchTerm = e.target.value;
          locationOptions.classList.remove("hidden");
          updateLocationOptions();
        });
        multiSelect.addEventListener("click", () => {
          locationOptions.classList.toggle("hidden");
          if (!locationOptions.classList.contains("hidden")) {
            updateLocationOptions();
            locationSearch.focus();
          }
        });
        document.addEventListener("click", (e) => {
          if (!multiSelect.contains(e.target)) {
            locationOptions.classList.add("hidden");
          }
        });
        const filterButtons = locationOptions.querySelectorAll("[data-filter]");
        filterButtons.forEach((button) => {
          button.addEventListener("click", () => {
            filterButtons.forEach((btn) =>
              btn.classList.remove(
                "active",
                "bg-primary",
                "text-white",
                "border-primary",
              ),
            );
            button.classList.add(
              "active",
              "bg-primary",
              "text-white",
              "border-primary",
            );
            currentState.currentFilter = button.dataset.filter;
            updateLocationOptions();
          });
        });
        // Initialize
        initProvinceSelect();
        updateTags();
        const maxTravelDistance = document.getElementById("maxTravelDistance");
        const postalCode = document.getElementById("postalCode");
        const toggleMapBtn = document.getElementById("toggleMapBtn");
        const mapContainer = document.getElementById("mapContainer");
        const radiusCircle = document.getElementById("radiusCircle");
        let currentUser = {
          locations: [],
          maxTravelKm: 0,
          postalCode: "",
          currentFilter: "all",
        };
        function createLocationList(filter = "") {
          locationOptionsContent.innerHTML = "";
          const searchTerm = filter.toLowerCase();
          function createLocationItem(location, type) {
            if (!location.toLowerCase().includes(searchTerm)) return null;
            const div = document.createElement("div");
            div.className =
              "p-2 hover:bg-gray-50 cursor-pointer text-sm flex items-center justify-between group";
            div.innerHTML = `
      <span>${location}</span>
      <span class="text-xs text-gray-400 opacity-0 group-hover:opacity-100">${type}</span>
      `;
            div.onclick = () => selectLocation(location, type);
            return div;
          }
          if (
            currentUser.currentFilter === "all" ||
            currentUser.currentFilter === "province"
          ) {
            locations.provinces.forEach((province) => {
              const item = createLocationItem(province, "Province");
              if (item) locationOptionsContent.appendChild(item);
            });
          }
          if (
            currentUser.currentFilter === "all" ||
            currentUser.currentFilter === "metro"
          ) {
            locations.metros.forEach((metro) => {
              const item = createLocationItem(metro, "Metro");
              if (item) locationOptionsContent.appendChild(item);
            });
          }
          if (
            currentUser.currentFilter === "all" ||
            currentUser.currentFilter === "suburb"
          ) {
            Object.values(locations.suburbs)
              .flat()
              .forEach((suburb) => {
                const item = createLocationItem(suburb, "Suburb");
                if (item) locationOptionsContent.appendChild(item);
              });
          }
          if (locationOptionsContent.children.length === 0) {
            const noResults = document.createElement("div");
            noResults.className = "p-4 text-center text-sm text-gray-500";
            noResults.textContent = "No locations found";
            locationOptionsContent.appendChild(noResults);
          }
        }
        function selectLocation(location, type) {
          if (!currentUser.locations.includes(location)) {
            currentUser.locations.push(location);
            updateTags();
            saveLocationPreferences();
          }
          locationOptions.classList.add("hidden");
          searchInput.value = "";
        }
        function updateMapRadius() {
          const radius = maxTravelDistance.value || 0;
          const size = Math.min(radius * 2, 300);
          radiusCircle.style.width = `${size}px`;
          radiusCircle.style.height = `${size}px`;
        }
        toggleMapBtn.addEventListener("click", () => {
          mapContainer.classList.toggle("hidden");
          if (!mapContainer.classList.contains("hidden")) {
            updateMapRadius();
          }
        });
        maxTravelDistance.addEventListener("input", updateMapRadius);
        postalCode.addEventListener("input", (e) => {
          e.target.value = e.target.value.replace(/\D/g, "").slice(0, 4);
        });
        // Filter buttons event listeners are already handled above
        function updateTags() {
          selectedTags.innerHTML = "";
          currentUser.locations.forEach((location) => {
            const tag = document.createElement("div");
            tag.className =
              "bg-gray-100 hover:bg-gray-200 rounded-full px-3 py-1.5 text-sm flex items-center gap-2 transition-colors";
            tag.innerHTML = `
      <span class="truncate max-w-[150px]">${location}</span>
      <button class="w-4 h-4 flex items-center justify-center hover:text-primary" onclick="removeLocation('${location}')">
      <i class="ri-close-line"></i>
      </button>
      `;
            selectedTags.appendChild(tag);
          });
          if (currentUser.locations.length === 0) {
            const placeholder = document.createElement("div");
            placeholder.className = "text-sm text-gray-400 px-1";
            placeholder.textContent = "No locations selected";
            selectedTags.appendChild(placeholder);
          }
        }
        window.removeLocation = function (location) {
          currentUser.locations = currentUser.locations.filter(
            (loc) => loc !== location,
          );
          updateTags();
          saveLocationPreferences();
        };
        multiSelect.addEventListener("click", () => {
          locationOptions.classList.toggle("hidden");
          if (!locationOptions.classList.contains("hidden")) {
            createLocationList();
            searchInput.focus();
          }
        });
        searchInput.addEventListener("input", (e) => {
          createLocationList(e.target.value);
          locationOptions.classList.remove("hidden");
        });
        document.addEventListener("click", (e) => {
          if (!multiSelect.contains(e.target)) {
            locationOptions.classList.add("hidden");
          }
        });
        createLocationList();
        // Remove the unused function since we're using a custom multiselect implementation
        function saveLocationPreferences() {
          fetch(`${API_BASE_URL}/${JOBSEEKER_ID}/location-preferences`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${sessionStorage.getItem("token")}`,
            },
            body: JSON.stringify({
              locations: currentUser.locations,
              maxTravelKm: currentUser.maxTravelKm,
            }),
          })
            .then((response) => {
              if (!response.ok) throw new Error("Failed to save preferences");
              showToast("Location preferences saved successfully");
              loadVerificationStatus();
            })
            .catch((error) => {
              console.error("Save error:", error);
              showToast("Failed to save preferences. Please try again.");
            });
        }
        // Remove the unused dropdown code since we're using a custom multiselect
        maxTravelDistance.addEventListener("change", (e) => {
          const value = parseInt(e.target.value);
          if (value >= 0) {
            currentUser.maxTravelKm = value;
            saveLocationPreferences();
          }
        });
        maxTravelDistance.addEventListener("change", (e) => {
          const value = parseInt(e.target.value);
          if (value >= 0) {
            currentUser.maxTravelKm = value;
            saveLocationPreferences();
          }
        });
        const policeClearanceUpload = document.getElementById(
          "policeClearanceUpload",
        );
        const selectedFileName = document.getElementById("selectedFileName");
        const cvUpload = document.getElementById("cvUpload");
        const cvFileName = document.getElementById("cvFileName");
        cvUpload.addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const validTypes = [".pdf", ".doc", ".docx"];
            const fileExtension = "." + file.name.split(".").pop().toLowerCase();
            if (!validTypes.includes(fileExtension)) {
              showToast("Please upload a PDF or Word document");
              cvUpload.value = "";
              return;
            }
            cvFileName.textContent = file.name;
            const formData = new FormData();
            formData.append("cv", file);
            fetch(`${API_BASE_URL}/${JOBSEEKER_ID}/upload-cv`, {
              method: "POST",
              body: formData,
              headers: {
                Authorization: `Bearer ${sessionStorage.getItem("token")}`,
              },
            })
              .then((response) => {
                if (!response.ok) throw new Error("Upload failed");
                return response.json();
              })
              .then(() => {
                showToast("CV uploaded successfully");
                loadVerificationStatus();
              })
              .catch((error) => {
                console.error("Upload error:", error);
                showToast("Failed to upload CV. Please try again.");
                cvFileName.textContent = "";
                cvUpload.value = "";
              });
          }
        });
        policeClearanceUpload.addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            selectedFileName.textContent = file.name;
            const formData = new FormData();
            formData.append("policeClearance", file);
            fetch(`${API_BASE_URL}/${JOBSEEKER_ID}/upload-police-clearance`, {
              method: "POST",
              body: formData,
              headers: {
                Authorization: `Bearer ${sessionStorage.getItem("token")}`,
              },
            })
              .then((response) => {
                if (!response.ok) throw new Error("Upload failed");
                return response.json();
              })
              .then(() => {
                showToast("Police clearance document uploaded successfully");
                loadVerificationStatus();
              })
              .catch((error) => {
                console.error("Upload error:", error);
                showToast("Failed to upload document. Please try again.");
                selectedFileName.textContent = "";
                policeClearanceUpload.value = "";
              });
          }
        });
        const JOBSEEKER_ID = "123"; // Replace with actual ID
        const MAX_RETRIES = 3;
        const RETRY_DELAY = 1000;
        function showToast(message) {
          const existingToast = document.getElementById("notificationToast");
          if (existingToast) {
            existingToast.remove();
          }
          const toast = document.createElement("div");
          toast.id = "notificationToast";
          toast.className =
            "fixed top-20 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-opacity duration-300";
          toast.textContent = message;
          document.body.appendChild(toast);
          setTimeout(() => {
            toast.style.opacity = "0";
            setTimeout(() => toast.remove(), 300);
          }, 3000);
        }
        async function updateNotificationPreference(type, enabled) {
          try {
            await fetchWithRetry(
              `${API_BASE_URL}/${JOBSEEKER_ID}/notification-preferences`,
              {
                method: "POST",
                body: JSON.stringify({
                  type,
                  enabled,
                }),
              },
            );
            showToast(
              `${type.charAt(0).toUpperCase() + type.slice(1)} notifications ${enabled ? "enabled" : "disabled"}`,
            );
          } catch (error) {
            console.error("Failed to update notification preference:", error);
            showToast("Failed to update preferences. Please try again.");
          }
        }
        const notificationToggles = document.querySelectorAll(
          '.switch input[type="checkbox"]',
        );
        notificationToggles.forEach((toggle, index) => {
          const toggleId = `notificationToggle${index}`;
          toggle.id = toggleId;
          const slider = toggle.nextElementSibling;
          slider.setAttribute("for", toggleId);
          toggle.addEventListener("change", async (e) => {
            const type = e.target
              .closest(".flex")
              .querySelector("span")
              .textContent.toLowerCase()
              .includes("sms")
              ? "sms"
              : "whatsapp";
            await updateNotificationPreference(type, e.target.checked);
          });
          slider.addEventListener("click", async (e) => {
            e.preventDefault();
            const checkbox = e.target.previousElementSibling;
            checkbox.checked = !checkbox.checked;
            const type = checkbox
              .closest(".flex")
              .querySelector("span")
              .textContent.toLowerCase()
              .includes("sms")
              ? "sms"
              : "whatsapp";
            await updateNotificationPreference(type, checkbox.checked);
          });
        });
        async function fetchWithRetry(url, options, retries = MAX_RETRIES) {
          try {
            const response = await fetch(url, {
              ...options,
              headers: {
                Authorization: `Bearer ${sessionStorage.getItem("token")}`,
                "Content-Type": "application/json",
                ...options?.headers,
              },
            });
            if (response.status === 401) {
              // Handle token refresh or redirect to login
              window.location.href = "/login";
              return;
            }
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return await response.json();
          } catch (error) {
            if (retries > 0) {
              await new Promise((resolve) => setTimeout(resolve, RETRY_DELAY));
              return fetchWithRetry(url, options, retries - 1);
            }
            throw error;
          }
        }
        async function loadInterests() {
          const interestsLoading = document.getElementById("interestsLoading");
          const interestsError = document.getElementById("interestsError");
          const interestsEmpty = document.getElementById("interestsEmpty");
          const interestsData = document.getElementById("interestsData");
          const totalViewsEl = document.getElementById("totalViews");
          const newViewsEl = document.getElementById("newViews");
          try {
            interestsLoading.classList.remove("hidden");
            interestsError.classList.add("hidden");
            interestsEmpty.classList.add("hidden");
            interestsData.classList.add("hidden");
            const data = await fetchWithRetry(
              `${API_BASE_URL}/${JOBSEEKER_ID}/interests`,
            );
            totalViewsEl.textContent = `Total views: ${data.totalViews}`;
            if (data.newViews > 0) {
              newViewsEl.textContent = data.newViews;
              interestsData.classList.remove("hidden");
            } else {
              interestsEmpty.classList.remove("hidden");
            }
          } catch (error) {
            console.error("Failed to load interests:", error);
            interestsError.classList.remove("hidden");
          } finally {
            interestsLoading.classList.add("hidden");
          }
        }
        async function loadMessages() {
          const messagesLoading = document.getElementById("messagesLoading");
          const messagesError = document.getElementById("messagesError");
          const messagesEmpty = document.getElementById("messagesEmpty");
          const messagesData = document.getElementById("messagesData");
          const unreadCountEl = document.getElementById("unreadCount");
          const latestEmployerEl = document.getElementById("latestEmployer");
          const latestTimestampEl = document.getElementById("latestTimestamp");
          const latestSnippetEl = document.getElementById("latestSnippet");
          try {
            messagesLoading.classList.remove("hidden");
            messagesError.classList.add("hidden");
            messagesEmpty.classList.add("hidden");
            messagesData.classList.add("hidden");
            const data = await fetchWithRetry(
              `${API_BASE_URL}/${JOBSEEKER_ID}/messages?status=unread`,
            );
            unreadCountEl.textContent = `Unread: ${data.unreadCount}`;
            if (data.unreadCount > 0 && data.latest) {
              latestEmployerEl.textContent = data.latest.employerName;
              latestTimestampEl.textContent = new Date(
                data.latest.timestamp,
              ).toLocaleDateString();
              latestSnippetEl.textContent = data.latest.snippet;
              messagesData.classList.remove("hidden");
            } else {
              messagesEmpty.classList.remove("hidden");
            }
          } catch (error) {
            console.error("Failed to load messages:", error);
            messagesError.classList.remove("hidden");
          } finally {
            messagesLoading.classList.add("hidden");
          }
        }
        async function loadVerificationStatus() {
          try {
            let completedSteps = 0;
            const totalSteps = 5;
            // Check Resume Upload
            if (cvFileName.textContent) completedSteps++;
            // Check Police Clearance
            if (selectedFileName.textContent) completedSteps++;
            // Check Polygraph Test
            const polygraphStatus = document.getElementById("polygraphStatus");
            if (polygraphStatus.classList.contains("verified")) completedSteps++;
            // Check Location Preferences
            if (currentUser.locations.length > 0) completedSteps++;
            // Check References
            if (ref1Name.value && ref1Phone.value) completedSteps++;
            const percentage = Math.round((completedSteps / totalSteps) * 100);
            document.getElementById("progressPercentage").textContent =
              `${percentage}%`;
            // Update step indicators
            const steps = document.querySelectorAll(".step-connector");
            steps.forEach((step, index) => {
              if (index < completedSteps) {
                step.classList.add("completed");
                step.classList.add("active");
              } else {
                step.classList.remove("completed");
                step.classList.remove("active");
              }
            });
          } catch (error) {
            console.error("Failed to load verification status:", error);
          }
        }
        // Add form change event listeners
        document.querySelectorAll("input, select").forEach((element) => {
          element.addEventListener("change", loadVerificationStatus);
        });
        // Add file upload listeners
        cvUpload.addEventListener("change", loadVerificationStatus);
        policeClearanceUpload.addEventListener("change", loadVerificationStatus);
        // Initial load
        loadInterests();
        loadMessages();
        loadVerificationStatus();
        // Refresh data periodically (every 5 minutes)
        setInterval(() => {
          loadInterests();
          loadMessages();
          loadVerificationStatus();
        }, 300000);

        // Supabase Integration for User Data
        // Initialize Supabase client
        const SUPABASE_URL = 'https://dvbbvjlwmkqqyfqdbupg.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR2YmJ2amx3bWtxcXlmcWRidXBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzNjI0OTYsImV4cCI6MjA2NTkzODQ5Nn0.Zpkj5G3mTngZD2lMCo7Yr6PeyEJ3X6jHndHrvDgPylA';
        
        const supabaseClient = window.supabase?.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        if (!supabaseClient) {
          console.error('❌ Failed to initialize Supabase client');
          showNotification('Database connection failed', 'error');
        }

        // Global variables for user data
        let currentUserData = null;
        let realtimeSubscription = null;

        // Function to load user profile data from Supabase
        async function loadUserProfile() {
          try {
            // Check if user is authenticated
            const { data: { user }, error: userError } = await supabaseClient.auth.getUser();
            
            if (userError || !user) {
              console.error('User not authenticated:', userError);
              // Redirect to login if not authenticated
              window.location.href = 'login.html';
              return;
            }

            console.log('✅ User authenticated:', user.id);

            // Load job seeker data
            const { data: jobSeekerData, error: dbError } = await supabaseClient
              .from('job_seekers')
              .select('*')
              .eq('id', user.id)
              .single();

            if (dbError) {
              console.error('Error loading user profile:', dbError);
              showNotification('Failed to load profile data', 'error');
              return;
            }

            if (!jobSeekerData) {
              console.warn('No job seeker profile found for user');
              showNotification('Profile not found. Please complete registration.', 'error');
              return;
            }

            currentUserData = { ...user, ...jobSeekerData };
            updateDashboardWithUserData(currentUserData);
            
            // Set up real-time subscription for profile changes
            setupRealtimeSubscription(user.id);

          } catch (error) {
            console.error('Error in loadUserProfile:', error);
            showNotification('Failed to load profile', 'error');
          }
        }

        // Function to update dashboard with user data
        function updateDashboardWithUserData(userData) {
          try {
            console.log('🔄 Updating dashboard with user data:', userData);

            // Update user name in header/profile sections
            const userNameElements = document.querySelectorAll('.user-name, [data-user-name]');
            userNameElements.forEach(el => {
              if (userData.first_name && userData.surname) {
                el.textContent = `${userData.first_name} ${userData.surname}`;
              }
            });

            // Update professional title
            const titleElements = document.querySelectorAll('.user-title, [data-user-title]');
            titleElements.forEach(el => {
              if (userData.professional_title) {
                el.textContent = userData.professional_title;
              }
            });

            // Update form fields with IDs
            const fieldsToUpdate = {
              'email': userData.email,
              'phone': userData.phone,
              'location': userData.location,
              'professional_title': userData.professional_title,
              'first_name': userData.first_name,
              'surname': userData.surname,
              'travel_distance': userData.travel_distance,
              'years_experience': userData.years_experience,
              'industry': userData.industry
            };

            Object.entries(fieldsToUpdate).forEach(([fieldId, value]) => {
              const element = document.getElementById(fieldId);
              if (element && value) {
                if (element.tagName === 'SELECT') {
                  element.value = value;
                } else {
                  element.value = value;
                }
              }
            });

            // Update references
            const referenceFields = {
              'ref1Name': userData.reference_1_name,
              'ref1Phone': userData.reference_1_phone,
              'ref2Name': userData.reference_2_name,
              'ref2Phone': userData.reference_2_phone
            };

            Object.entries(referenceFields).forEach(([fieldId, value]) => {
              const element = document.getElementById(fieldId);
              if (element && value) {
                element.value = value;
              }
            });

            // Update skills
            if (userData.skills && Array.isArray(userData.skills) && userData.skills.length > 0) {
              updateSkillTags(userData.skills);
            }

            // Update selected jobs
            if (userData.selected_jobs && Array.isArray(userData.selected_jobs) && userData.selected_jobs.length > 0) {
              updateSelectedJobs(userData.selected_jobs);
            }

            // Update subscription tier display
            if (userData.subscription_tier) {
              updateSubscriptionDisplay(userData.subscription_tier);
            }

            // Update currentUser locations for the existing location logic
            if (userData.location && currentUser) {
              currentUser.locations = [userData.location];
            }

            console.log('✅ Dashboard updated with user data');
            showNotification('Profile loaded successfully', 'success');

          } catch (error) {
            console.error('Error updating dashboard:', error);
            showNotification('Error updating dashboard', 'error');
          }
        }

        // Function to update skill tags
        function updateSkillTags(skills) {
          const skillTagsContainer = document.getElementById('skillTags');
          if (!skillTagsContainer) return;

          skillTagsContainer.innerHTML = '';
          skills.forEach(skill => {
            const tag = document.createElement('span');
            tag.className = 'inline-flex items-center gap-1 bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm';
            tag.innerHTML = `${skill} <button onclick="removeSkill('${skill}')" class="text-gray-500 hover:text-gray-700">✕</button>`;
            skillTagsContainer.appendChild(tag);
          });
        }

        // Function to update selected jobs
        function updateSelectedJobs(jobs) {
          const selectedJobsContainer = document.getElementById('selectedJobs');
          if (!selectedJobsContainer) return;

          selectedJobsContainer.innerHTML = '';
          jobs.forEach(job => {
            const tag = document.createElement('span');
            tag.className = 'inline-flex items-center gap-1 bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm';
            tag.innerHTML = `${job} <button onclick="removeJob('${job}')" class="text-gray-500 hover:text-gray-700">✕</button>`;
            selectedJobsContainer.appendChild(tag);
          });
        }

        // Function to update subscription display
        function updateSubscriptionDisplay(tier) {
          // Find subscription tier cards and mark the current one as active
          const tierCards = document.querySelectorAll('.tier-card');
          tierCards.forEach(card => {
            const cardTier = card.querySelector('[data-tier]')?.getAttribute('data-tier');
            if (cardTier === tier) {
              card.classList.add('ring-2', 'ring-red-500');
            } else {
              card.classList.remove('ring-2', 'ring-red-500');
            }
          });
        }

        // Function to set up real-time subscription
        function setupRealtimeSubscription(userId) {
          if (realtimeSubscription) {
            realtimeSubscription.unsubscribe();
          }

          realtimeSubscription = supabaseClient
            .channel('job-seeker-changes')
            .on(
              'postgres_changes',
              {
                event: 'UPDATE',
                schema: 'public',
                table: 'job_seekers',
                filter: `id=eq.${userId}`
              },
              (payload) => {
                console.log('👁️ Real-time update received:', payload);
                if (payload.new) {
                  currentUserData = { ...currentUserData, ...payload.new };
                  updateDashboardWithUserData(currentUserData);
                  showNotification('Profile updated in real-time', 'success');
                }
              }
            )
            .subscribe();

          console.log('👁️ Real-time subscription set up for user:', userId);
        }

        // Function to save profile changes
        async function saveProfileChanges() {
          if (!currentUserData) {
            showNotification('No user data to save', 'error');
            return;
          }

          try {
            // Collect updated data from form fields
            const updatedData = {
              first_name: document.querySelector('input[placeholder*="First Name"]')?.value || currentUserData.first_name,
              surname: document.querySelector('input[placeholder*="Surname"]')?.value || currentUserData.surname,
              phone: document.querySelector('input[type="tel"]')?.value || currentUserData.phone,
              location: document.querySelector('input[placeholder*="location"], input[placeholder*="Location"]')?.value || currentUserData.location,
              professional_title: document.querySelector('input[placeholder*="Professional Title"]')?.value || currentUserData.professional_title,
              travel_distance: document.querySelector('select')?.value || currentUserData.travel_distance,
              reference_1_name: document.querySelector('input[placeholder*="Reference 1 Name"]')?.value || currentUserData.reference_1_name,
              reference_1_phone: document.querySelector('input[placeholder*="Reference 1 Phone"]')?.value || currentUserData.reference_1_phone,
              reference_2_name: document.querySelector('input[placeholder*="Reference 2 Name"]')?.value || currentUserData.reference_2_name,
              reference_2_phone: document.querySelector('input[placeholder*="Reference 2 Phone"]')?.value || currentUserData.reference_2_phone,
            };

            // Update in Supabase
            const { data, error } = await supabaseClient
              .from('job_seekers')
              .update(updatedData)
              .eq('id', currentUserData.id);

            if (error) {
              throw error;
            }

            console.log('✅ Profile saved successfully');
            showNotification('Profile saved successfully', 'success');

          } catch (error) {
            console.error('Error saving profile:', error);
            showNotification('Failed to save profile', 'error');
          }
        }

        // Function to show notifications
        function showNotification(message, type = 'info') {
          const notification = document.createElement('div');
          notification.className = `fixed top-4 right-4 px-4 py-2 rounded shadow-lg z-50 ${
            type === 'success' ? 'bg-green-500 text-white' : 
            type === 'error' ? 'bg-red-500 text-white' : 
            'bg-blue-500 text-white'
          }`;
          notification.textContent = message;
          document.body.appendChild(notification);
          setTimeout(() => notification.remove(), 3000);
        }

        // Load user profile on page load
        loadUserProfile();

        // Add save button functionality
        document.addEventListener('click', function(e) {
          if (e.target.matches('[data-action="save-profile"]') || e.target.closest('[data-action="save-profile"]')) {
            saveProfileChanges();
          }
        });

        // Auto-save on form changes (debounced)
        let saveTimeout;
        document.addEventListener('input', function(e) {
          if (e.target.matches('input, select, textarea')) {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
              saveProfileChanges();
            }, 2000); // Auto-save after 2 seconds of inactivity
          }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
          if (realtimeSubscription) {
            realtimeSubscription.unsubscribe();
          }
        });
      });
    </script>
  </body>
</html>
